/*! grapesjs-template-manager - 1.0.7 */
!function(e,t){'object'==typeof exports&&'object'==typeof module?module.exports=t():'function'==typeof define&&define.amd?define([],t):'object'==typeof exports?exports["grapesjs-template-manager"]=t():e["grapesjs-template-manager"]=t()}(window,(function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){'undefined'!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:'Module'}),Object.defineProperty(e,'__esModule',{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&'object'==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,'default',{enumerable:!0,value:e}),2&t&&'string'!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e['default']}:function(){return e};return n.d(t,'a',t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=6)}([function(e,t){e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},e.exports["default"]=e.exports,e.exports.__esModule=!0},function(e,t,n){var r=n(5);e.exports=function(e,t){if(null==e)return{};var n,o,i=r(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i},e.exports["default"]=e.exports,e.exports.__esModule=!0},function(e,t,n){!function(t){'use strict';var n=function(){return{escape:function(e){return e.replace(/([.*+?^${}()|\[\]\/\\])/g,'\\$1')},parseExtension:t,mimeType:function(e){var n=t(e).toLowerCase();return(r='application/font-woff',o='image/jpeg',{woff:r,woff2:r,ttf:'application/font-truetype',eot:'application/vnd.ms-fontobject',png:'image/png',jpg:o,jpeg:o,gif:'image/gif',tiff:'image/tiff',svg:'image/svg+xml'})[n]||'';var r,o},dataAsUrl:function(e,t){return'data:'+t+';base64,'+e},isDataUrl:function(e){return-1!==e.search(/^(data:)/)},canvasToBlob:function(e){return e.toBlob?new Promise((function(t){e.toBlob(t)})):function(e){return new Promise((function(t){for(var n=window.atob(e.toDataURL().split(',')[1]),r=n.length,o=new Uint8Array(r),i=0;i<r;i++)o[i]=n.charCodeAt(i);t(new Blob([o],{type:'image/png'}))}))}(e)},resolveUrl:function(e,t){var n=document.implementation.createHTMLDocument(),r=n.createElement('base');n.head.appendChild(r);var o=n.createElement('a');return n.body.appendChild(o),r.href=t,o.href=e,o.href},getAndEncode:function(e){var t=3e4;c.impl.options.cacheBust&&(e+=(/\?/.test(e)?"&":"?")+(new Date).getTime());return new Promise((function(n){var r,o=new XMLHttpRequest;if(o.onreadystatechange=function(){if(4!==o.readyState)return;if(200!==o.status)return void(r?n(r):a('cannot fetch resource: '+e+', status: '+o.status));var t=new FileReader;t.onloadend=function(){var e=t.result.split(/,/)[1];n(e)},t.readAsDataURL(o.response)},o.ontimeout=function(){r?n(r):a('timeout of '+t+'ms occured while fetching resource: '+e)},o.responseType='blob',o.timeout=t,o.open('GET',e,!0),o.send(),c.impl.options.imagePlaceholder){var i=c.impl.options.imagePlaceholder.split(/,/);i&&i[1]&&(r=i[1])}function a(e){console.error(e),n('')}}))},uid:(e=0,function(){return'u'+('0000'+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)+e++}),delay:function(e){return function(t){return new Promise((function(n){setTimeout((function(){n(t)}),e)}))}},asArray:function(e){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t},escapeXhtml:function(e){return e.replace(/#/g,'%23').replace(/\n/g,'%0A')},makeImage:function(e){return new Promise((function(t,n){var r=new Image;r.onload=function(){t(r)},r.onerror=n,r.src=e}))},width:function(e){var t=n(e,'border-left-width'),r=n(e,'border-right-width');return e.scrollWidth+t+r},height:function(e){var t=n(e,'border-top-width'),r=n(e,'border-bottom-width');return e.scrollHeight+t+r}};var e;function t(e){var t=/\.([^\.\/]*?)$/g.exec(e);return t?t[1]:''}function n(e,t){var n=window.getComputedStyle(e).getPropertyValue(t);return parseFloat(n.replace('px',''))}}(),r=function(){var e=/url\(['"]?([^'"]+?)['"]?\)/g;return{inlineAll:function(e,n,i){return function(){return!t(e)}()?Promise.resolve(e):Promise.resolve(e).then(r).then((function(t){var r=Promise.resolve(e);return t.forEach((function(e){r=r.then((function(t){return o(t,e,n,i)}))})),r}))},shouldProcess:t,impl:{readUrls:r,inline:o}};function t(t){return-1!==t.search(e)}function r(t){for(var r,o=[];null!==(r=e.exec(t));)o.push(r[1]);return o.filter((function(e){return!n.isDataUrl(e)}))}function o(e,t,r,o){return Promise.resolve(t).then((function(e){return r?n.resolveUrl(e,r):e})).then(o||n.getAndEncode).then((function(e){return n.dataAsUrl(e,n.mimeType(t))})).then((function(r){return e.replace(function(e){return new RegExp('(url\\([\'"]?)('+n.escape(e)+')([\'"]?\\))','g')}(t),'$1'+r+'$3')}))}}(),o=function(){return{resolveAll:function(){return e(document).then((function(e){return Promise.all(e.map((function(e){return e.resolve()})))})).then((function(e){return e.join('\n')}))},impl:{readAll:e}};function e(){return Promise.resolve(n.asArray(document.styleSheets)).then((function(e){var t=[];return e.forEach((function(e){try{n.asArray(e.cssRules||[]).forEach(t.push.bind(t))}catch(t){console.log('Error while reading CSS rules from '+e.href,t.toString())}})),t})).then((function(e){return e.filter((function(e){return e.type===CSSRule.FONT_FACE_RULE})).filter((function(e){return r.shouldProcess(e.style.getPropertyValue('src'))}))})).then((function(t){return t.map(e)}));function e(e){return{resolve:function(){var t=(e.parentStyleSheet||{}).href;return r.inlineAll(e.cssText,t)},src:function(){return e.style.getPropertyValue('src')}}}}}(),i=function(){return{inlineAll:function t(o){return o instanceof Element?function(e){var t=e.style.getPropertyValue('background');return t?r.inlineAll(t).then((function(t){e.style.setProperty('background',t,e.style.getPropertyPriority('background'))})).then((function(){return e})):Promise.resolve(e)}(o).then((function(){return o instanceof HTMLImageElement?e(o).inline():Promise.all(n.asArray(o.childNodes).map((function(e){return t(e)})))})):Promise.resolve(o)},impl:{newImage:e}};function e(e){return{inline:function(t){return n.isDataUrl(e.src)?Promise.resolve():Promise.resolve(e.src).then(t||n.getAndEncode).then((function(t){return n.dataAsUrl(t,n.mimeType(e.src))})).then((function(t){return new Promise((function(n,r){e.onload=n,e.onerror=r,e.src=t}))}))}}}}(),a={imagePlaceholder:void 0,cacheBust:!1},c={toSvg:s,toPng:function(e,t){return u(e,t||{}).then((function(e){return e.toDataURL()}))},toJpeg:function(e,t){return u(e,t=t||{}).then((function(e){return e.toDataURL('image/jpeg',t.quality||1)}))},toBlob:function(e,t){return u(e,t||{}).then(n.canvasToBlob)},toPixelData:function(e,t){return u(e,t||{}).then((function(t){return t.getContext('2d').getImageData(0,0,n.width(e),n.height(e)).data}))},impl:{fontFaces:o,images:i,util:n,inliner:r,options:{}}};function s(e,t){return function(e){void 0===e.imagePlaceholder?c.impl.options.imagePlaceholder=a.imagePlaceholder:c.impl.options.imagePlaceholder=e.imagePlaceholder;void 0===e.cacheBust?c.impl.options.cacheBust=a.cacheBust:c.impl.options.cacheBust=e.cacheBust}(t=t||{}),Promise.resolve(e).then((function(e){return function e(t,r,o){return o||!r||r(t)?Promise.resolve(t).then((function(e){return e instanceof HTMLCanvasElement?n.makeImage(e.toDataURL()):e.cloneNode(!1)})).then((function(e){return i(t,e,r)})).then((function(e){return function(e,t){return t instanceof Element?Promise.resolve().then(r).then(o).then(i).then(a).then((function(){return t})):t;function r(){var r,o;r=window.getComputedStyle(e),o=t.style,r.cssText?o.cssText=r.cssText:function(e,t){n.asArray(e).forEach((function(n){t.setProperty(n,e.getPropertyValue(n),e.getPropertyPriority(n))}))}(r,o)}function o(){[':before',':after'].forEach((function(r){!function(r){var o=window.getComputedStyle(e,r),i=o.getPropertyValue('content');if(''===i||'none'===i)return;var a=n.uid();t.className=t.className+' '+a;var c=document.createElement('style');c.appendChild(function(e,t,r){var o='.'+e+':'+t,i=r.cssText?function(e){var t=e.getPropertyValue('content');return e.cssText+' content: '+t+';'}(r):function(e){return n.asArray(e).map((function(t){return t+': '+e.getPropertyValue(t)+(e.getPropertyPriority(t)?' !important':'')})).join('; ')+';'}(r);return document.createTextNode(o+'{'+i+'}')}(a,r,o)),t.appendChild(c)}(r)}))}function i(){e instanceof HTMLTextAreaElement&&(t.innerHTML=e.value),e instanceof HTMLInputElement&&t.setAttribute("value",e.value)}function a(){t instanceof SVGElement&&(t.setAttribute('xmlns','http://www.w3.org/2000/svg'),t instanceof SVGRectElement&&['width','height'].forEach((function(e){var n=t.getAttribute(e);n&&t.style.setProperty(e,n)})))}}(t,e)})):Promise.resolve();function i(t,r,o){var i=t.childNodes;return 0===i.length?Promise.resolve(r):a(r,n.asArray(i),o).then((function(){return r}));function a(t,n,r){var o=Promise.resolve();return n.forEach((function(n){o=o.then((function(){return e(n,r)})).then((function(e){e&&t.appendChild(e)}))})),o}}}(e,t.filter,!0)})).then(l).then(d).then((function(e){t.bgcolor&&(e.style.backgroundColor=t.bgcolor);t.width&&(e.style.width=t.width+'px');t.height&&(e.style.height=t.height+'px');t.style&&Object.keys(t.style).forEach((function(n){e.style[n]=t.style[n]}));return e})).then((function(r){return function(e,t,r){return Promise.resolve(e).then((function(e){return e.setAttribute('xmlns','http://www.w3.org/1999/xhtml'),(new XMLSerializer).serializeToString(e)})).then(n.escapeXhtml).then((function(e){return'<foreignObject x="0" y="0" width="100%" height="100%">'+e+'</foreignObject>'})).then((function(e){return'<svg xmlns="http://www.w3.org/2000/svg" width="'+t+'" height="'+r+'">'+e+'</svg>'})).then((function(e){return'data:image/svg+xml;charset=utf-8,'+e}))}(r,t.width||n.width(e),t.height||n.height(e))}))}function u(e,t){return s(e,t).then(n.makeImage).then(n.delay(100)).then((function(r){var o=function(e){var r=document.createElement('canvas');if(r.width=t.width||n.width(e),r.height=t.height||n.height(e),t.bgcolor){var o=r.getContext('2d');o.fillStyle=t.bgcolor,o.fillRect(0,0,r.width,r.height)}return r}(e);return o.getContext('2d').drawImage(r,0,0),o}))}function l(e){return o.resolveAll().then((function(t){var n=document.createElement('style');return e.appendChild(n),n.appendChild(document.createTextNode(t)),e}))}function d(e){return i.inlineAll(e).then((function(){return e}))}1&&(e.exports=c)}()},function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},e.exports["default"]=e.exports,e.exports.__esModule=!0},function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.exports=function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e},e.exports["default"]=e.exports,e.exports.__esModule=!0},function(e,t){e.exports=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o},e.exports["default"]=e.exports,e.exports.__esModule=!0},function(e,t,n){"use strict";n.r(t);var r=n(0),o=n.n(r),i=n(2),a=n.n(i);function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var u=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.Commands;e.domtoimage=a.a;var r=function(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(function(e){return(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16)}))},o=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;a.a.toJpeg(e,t).then((function(e){return n&&n(e)})).catch((function(e){return r&&r(e)}))};n.add('get-uuidv4',(function(){return r()})),n.add('take-screenshot',(function(e){var n=e.getWrapper().getEl();o(n,{quality:t.quality,height:1e3,cacheBust:!0,style:s({'background-color':'white'},e.getWrapper().getStyle())},(function(t){return e.Storage.getCurrentStorage().setThumbnail(t)}),t.onScreenshotError)})),n.add('save-as-template',(function(e){e.Storage.getCurrentStorage().setIsTemplate(!0),e.store()})),n.add('delete-template',(function(e){e.Storage.getCurrentStorage().delete(t.onDelete,t.onDeleteError)}))},l=n(1),d=n.n(l),f='indexeddb',p='rest-api',h='firestore';function m(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function g(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?m(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var v=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.StorageManager,o=f,i=n.objectStoreName,a=function(){return t},c=function(e){if(t)e(t);else{var a=(window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB).open(n.dbName,n.indexeddbVersion),c=function(){return r.onError(o,a.errorCode)};a.onerror=c,a.onsuccess=function(){(t=a.result).onerror=c,e(t)},a.onupgradeneeded=function(e){e.currentTarget.result.createObjectStore(i,{keyPath:'idx'}).createIndex('id','id',{unique:!1})}}},s=function(){return t.transaction([i],'readwrite').objectStore(i)},u=function(e){t?e(s()):c((function(t){return e(s())}))};r.add(o,{currentId:'Default',currentIdx:'uuidv4',currentThumbnail:'',isTemplate:!1,getDb:a,getObjectStore:s,setId:function(e){this.currentId=e},setIdx:function(e){this.currentIdx=e},setThumbnail:function(e){this.currentThumbnail=e},setIsTemplate:function(e){this.isTemplate=!!e},load:function(e,t,n){var r=this;u((function(e){var o=e.get(r.currentIdx);o.onerror=n,o.onsuccess=function(){t&&t(o.result)}}))},loadAll:function(e,t){u((function(n){var r=n.getAll();r.onerror=t,r.onsuccess=function(){e&&e(r.result)}}))},store:function(e,t,n){var r=this;u((function(o){var i=o.put(g({idx:r.currentIdx,id:r.currentId,template:r.isTemplate,thumbnail:r.currentThumbnail},e));i.onerror=n,i.onsuccess=t}))},update:function(e,t,n){var r=e.idx,o=d()(e,["idx"]);u((function(e){var i=e.get(r);i.onerror=n,i.onsuccess=function(){e.put(g(g({idx:r},i.result),o)),t&&t(i.result)}}))},delete:function(e,t,n){var r=this;u((function(o){var i=o.delete(n||r.currentIdx);i.onerror=t,i.onsuccess=e}))}})};function b(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?b(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):b(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var x=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.StorageManager,r=p,o=n.get('remote');n.add(r,{currentId:'Default',currentIdx:'uuidv4',currentThumbnail:'',isTemplate:!1,setId:function(e){this.currentId=e},setIdx:function(e){this.currentIdx=e},setThumbnail:function(e){this.currentThumbnail=e},setIsTemplate:function(e){this.isTemplate=!!e},load:function(e,t,n){var r=o.get('urlLoad'),i=r.endsWith("/")?this.currentIdx:"/".concat(this.currentIdx);o.set({urlLoad:r+i}),o.load(e,t,n),o.set({urlLoad:r})},loadAll:function(e,t){o.load({},e,t)},store:function(e,n,r){var i=o.get('urlStore'),a=i.endsWith("/")?this.currentIdx:"/".concat(this.currentIdx);t.uuidInPath&&o.set({urlStore:i+a}),o.store(y({idx:this.currentIdx,id:this.currentId,template:this.isTemplate,thumbnail:this.currentThumbnail},e),n,r),o.set({urlStore:i})},update:function(e,t,n){var r=o.get('urlLoad'),i=e.idx;i=r.endsWith("/")?i:"/".concat(i),o.set({urlLoad:r+i}),o.load({},(function(r){var a=y(y({},r),e),c=o.get('urlStore');i=c.endsWith("/")?i:"/".concat(i),o.request(c+i,{method:'post',body:a},t,n)}),n),o.set({urlLoad:r})},delete:function(e,t,n){var r=o.get('urlDelete'),i=n||this.currentIdx;i=r.endsWith("/")?i:"/".concat(i);o.request(r+i,{method:'delete'},e,t)}})};function w(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function O(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?w(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):w(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var P=function(e){var t,n,r,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=e.StorageManager,a=h,c=o.apiKey,s=o.authDomain,u=o.projectId,l=o.settings,f=function(){return n},p=function(e){if(r)return e(r);firebase.apps.length?(firebase.app(),(t=firebase.firestore()).settings(l)):(firebase.initializeApp(O({apiKey:c,authDomain:s,projectId:u},o.firebaseConfig)),(t=firebase.firestore()).settings(l));r=t.collection(o.objectStoreName),e(r)},m=function(t){p((function(r){var o=e.Storage.getCurrentStorage();n=r.doc(o.currentIdx),t(n)}))};i.add(a,{currentId:'Default',currentIdx:'uuidv4',currentThumbnail:'',isTemplate:!1,getDoc:f,setDocId:function(e){this.currentIdx=e},setId:function(e){this.currentId=e},setIdx:function(e){this.currentIdx=e},setThumbnail:function(e){this.currentThumbnail=e},setIsTemplate:function(e){this.isTemplate=!!e},load:function(e,t,n){m((function(e){e.get().then((function(e){return e.exists&&t(e.data())})).catch(n)}))},loadAll:function(e,t){p((function(n){n.get().then((function(t){var n=[];t.forEach((function(e){return n.push(e.data())})),e(n)})).catch(t)}))},store:function(e,t,n){var r=this;p((function(o){o.doc(e.idx||r.currentIdx).set(O({idx:r.currentIdx,id:r.currentId,template:r.isTemplate,thumbnail:r.currentThumbnail},e)).then(t).catch(n)}))},update:function(e,t,n){var r=e.idx,o=d()(e,["idx"]);p((function(e){e.doc(r).set(o,{merge:!0}).then(t).catch(n)}))},delete:function(e,t,n){n?p((function(r){r.doc(n).delete().then(e).catch(t)})):m((function(n){n.delete().then(e).catch(t)}))}})},j=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};v(e,t),x(e,t),P(e,t)},S=n(3),T=n.n(S),I=n(4),C=n.n(I);function E(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var k=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};T()(this,e),this.editor=t,this.$=t.$,this.pfx=t.getConfig('stylePrefix'),this.id=t.Storage.getConfig().id||'gjs-',this.opts=n}return C()(e,[{key:"_createPage",value:function(){var e=this.editor,t=this.templateIdx,n=this.page,r=e.Storage.getCurrentStorage();r.setIdx(t),r.setIsTemplate(!1),this.page&&e.load((function(t){e.setComponents(t.components?JSON.parse(t.components):t.html),e.setStyle(t.styles?JSON.parse(t.styles):t.css),r.setId(n),r.setIdx(e.runCommand('get-uuidv4')),r.setThumbnail(t.thumbnail||''),e.Modal.close()}))}},{key:"_openTemplate",value:function(){var e=this.editor,t=this.templateIdx,n=e.Storage.getCurrentStorage();n.setIdx(t),n.setIsTemplate(!0),e.load((function(t){e.setComponents(t.components?JSON.parse(t.components):t.html),e.setStyle(t.styles?JSON.parse(t.styles):t.css),n.setThumbnail(t.thumbnail||''),e.Modal.close()}))}},{key:"_selectTemplate",value:function(e){var t=this.pfx,n=e.currentTarget;this.templateIdx=n.dataset.idx,this.$(".".concat(t,"templates-card")).each((function(e,n){n.classList.remove("".concat(t,"templates-card-active"))})),n.parentElement.classList.add("".concat(t,"templates-card-active"))}},{key:"_openPage",value:function(e){var t=this.editor,n=t.Storage.getCurrentStorage();n.setIdx(e.currentTarget.dataset.idx),n.setIsTemplate(!1),t.load((function(e){t.setComponents(e.components?JSON.parse(e.components):e.html),t.setStyle(e.styles?JSON.parse(e.styles):e.css),n.setId(e.id),n.setThumbnail(e.thumbnail||''),t.Modal.close()}))}},{key:"_editName",value:function(e){var t=this.$(e.currentTarget.parentElement),n=t.children().first(),r=t.find(".".concat(this.pfx,"field")),o=r.find('input');'block'===r.get(0).style.display?(n.text(o.val()),r.hide(),this.editor.Storage.getCurrentStorage().update({idx:e.currentTarget.dataset.idx,id:o.val().trim()})):(o.val(n.text().trim()),n.text('...'),r.show())}},{key:"_deletePage",value:function(e){var t=this.editor,n=this.opts;t.Storage.getCurrentStorage().delete(n.onDelete,n.onDeleteError,e.currentTarget.dataset.idx),e.currentTarget.parentElement.parentElement.style.display='none'}},{key:"_thumbs",value:function(e,t){return"<div class=\"".concat(this.pfx,"templates-card\" data-idx=\"").concat(e,"\">\n                ").concat(t,"\n            </div>")}},{key:"_thumbsCont",value:function(e){var t=this,n=this.$("<div class=\"".concat(this.pfx,"templates-card-2\">\n                ").concat(e,"\n            </div>"));return n.find('i.fa.fa-i-cursor').on('click',(function(e){return t._editName(e)})),n.find('i.fa.fa-trash-o').on('click',(function(e){return t._deletePage(e)})),n}},{key:"_pages",value:function(e){var t=this,n=this.pfx,r=this.editor.Storage.getCurrentStorage(),o=this._thumbsCont(e);return o.find(".".concat(n,"templates-card")).filter((function(e,t){return t.getAttribute('data-idx')==r.currentIdx})).addClass("".concat(n,"templates-card-active")).find('i.fa').hide(),o.find(".".concat(this.pfx,"thumb-select")).on('click',(function(e){return t._openPage(e)})),o}},{key:"_templates",value:function(e){var t=this,n=this.pfx,r=this._thumbsCont(e);return r.find(".".concat(n,"templates-card")).filter((function(e,n){return n.getAttribute('data-idx')==t.templateIdx})).addClass("".concat(n,"templates-card-active")).find('i.fa').hide(),r.find(".".concat(n,"thumb-select")).on('click',(function(e){return t._selectTemplate(e)})),r}},{key:"_tabs",value:function(){var e=this.pfx,t=this.$,n=this.opts,r=t("<div class=\"".concat(e,"tab\">\n                <button class=\"").concat(e,"tablinks active\">").concat(n.tabsText.pages,"</button>\n                <button class=\"").concat(e,"tablinks\">").concat(n.tabsText.templates,"</button>\n            </div>"));return r.find('button').on('click',(function(n){var o=n.currentTarget;r.find(".".concat(e,"tablinks")).removeClass('active'),t(o).addClass('active'),'pages'===o.innerHTML.toLowerCase()?(t('.templates-tab').hide(),t('.pages-tab').show()):(t('.templates-tab').show(),t('.pages-tab').hide())})),r}},{key:"loader",value:function(){return'<div class="lds-ellipsis"><div></div><div></div><div></div><div></div></div>'}},{key:"noPages",value:function(){return"<div class=\"".concat(this.pfx,"templates-card-2\">").concat(this.opts.nopages,"</div>")}},{key:"noTemplates",value:function(){var e=this,t=this.$,n=this.id,r=this.pfx,i=this.opts,a=this.editor,c=a.Storage.getCurrentStorage(),s=t("<div class=\"".concat(r,"templates-card-2\">\n                <div style=\"display:flex;align-items:center;padding:50px;margin:auto;\">\n                    <button class=\"").concat(r,"btn-prim ").concat(r,"btn-wide\" id=\"create-blank\">\n                        ").concat(i.btnText.createBlank,"\n                    </button>\n                </div>\n            </div>"));return s.find('#create-blank').on('click',(function(){var i={};i["".concat(n,"html")]='',i["".concat(n,"css")]='',c.store(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?E(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):E(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({idx:a.runCommand('get-uuidv4'),id:'Blank',template:!0,thumbnail:''},i)),c.loadAll((function(n){var o=t('#pages').find('#templates-container');o.find(".".concat(r,"templates-card-2")).remove(),o.append(e.update(n.filter((function(e){return e.template})),!1))}),(function(e){return console.log("Error",e)}))})),s}},{key:"render",value:function(){var e=this,t=this.pfx,n=this.$,r=this.opts,o=this._tabs(),i=n("<div id=\"pages\" class=\"".concat(t,"templates ").concat(t,"one-bg ").concat(t,"two-color\">\n            <div class=\"").concat(t,"templates-overlay\"></div>\n            <div class=\"").concat(t,"templates-cont\">\n                <div class=\"").concat(t,"fonts templates-tab\" style=\"display:none\">\n                    <div class=\"").concat(t,"tip-about ").concat(t,"four-color\">").concat(r.help,"</div>\n                    <label class=\"").concat(t,"field-label\" for=\"page-name\">").concat(r.nameLabel,"</label>\n                    <div class=\"").concat(t,"field\">\n                        <input type=\"text\" name=\"pageName\" id=\"page-name\">\n                    </div>\n                    <span>\n                        <button class=\"").concat(t,"btn-prim ").concat(t,"btn-wide\" id=\"template-edit\">\n                            ").concat(r.btnText.edit,"\n                        </button>\n                    </span>\n                    <span>\n                        <button class=\"").concat(t,"btn-prim ").concat(t,"btn-wide\" id=\"page-create\">\n                            ").concat(r.btnText.create,"\n                        </button>\n                    </span>\n                </div>\n                <div id=\"pages-container\" class=\"pages-tab\">\n                    <button class=\"").concat(t,"btn-prim ").concat(t,"btn-wide\" id=\"templates-tab\">\n                        ").concat(r.btnText.new,"\n                    </button>\n                </div>\n                <div id=\"templates-container\" class=\"templates-tab\" style=\"display:none\"></div>\n            </div>\n        </div>"));return i.find('#templates-tab').on('click',(function(){var e=o.find(".".concat(t,"tablinks"));e.removeClass('active'),n(e.get(1)).addClass('active'),n('.templates-tab').show(),n('.pages-tab').hide()})),i.find('#page-name').on('keyup',(function(t){return e.page=t.currentTarget.value})),i.find('#page-create').on('click',(function(){return e._createPage()})),i.find('#template-edit').on('click',(function(){return e._openTemplate()})),i.find(".".concat(t,"templates-cont")).prepend(o),i}},{key:"update",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r='',o=this.pfx,i=this.id;return e.length?(e.forEach((function(e){var n="<svg xmlns=\"http://www.w3.org/2000/svg\" class=\"template-preview\" viewBox=\"0 0 1300 1100\" width=\"99%\" height=\"220\">\n                    <foreignObject width=\"100%\" height=\"100%\" style=\"pointer-events:none\">\n                    <div xmlns=\"http://www.w3.org/1999/xhtml\" ".concat(e["".concat(i,"html")]?'':'padding-top:100%',"\">\n                    ").concat(e["".concat(i,"html")]+'<style scoped>'+e["".concat(i,"css")]+'</style>',"\n                    </div>\n                    </foreignObject>\n                </svg>"),a=e.thumbnail?"<div class=\"".concat(o,"thumbnail-cont\">\n                    <img class=\"template-preview\" src=\"").concat(e.thumbnail,"\" alt=\"").concat(e.id,"\">\n                </div>"):n;a="<div class=\"".concat(o,"thumb-select\" data-idx=\"").concat(e.idx,"\">\n                    ").concat(a,"\n                </div>\n                <div class=\"label\">\n                    <div>").concat(e.id,"</div>\n                    <div class=\"").concat(o,"field\" style=\"display:none;\" >\n                        <input type=\"text\" placeholder=\"page name\" data-idx=\"").concat(e.idx,"\">\n                    </div>\n                    <i class=\"").concat(o,"caret-icon fa fa-i-cursor\" title=\"rename\" data-idx=\"").concat(e.idx,"\"></i>\n                    <i class=\"").concat(o,"caret-icon fa fa-trash-o\" title=\"delete\" data-idx=\"").concat(e.idx,"\"></i>\n                </div>"),r+=t._thumbs(e.idx,a)})),n?this._pages(r):this._templates(r)):n?this.noPages():this.noTemplates()}}]),e}(),D=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.$,r=e.Modal,o=e.StorageManager,i=e.getConfig('stylePrefix'),a="".concat(i,"mdl-dialog-tml"),c=null;e.Commands.add('open-templates',{run:function(e,s){var u=document.querySelector(".".concat(i,"mdl-dialog"));u.classList.add(a),s&&s.set&&s&&s.set('active'),!c&&(c=new k(e,t)),r.setTitle(t.mdlTitle),r.setContent(n('.lds-ellipsis').length?n('.lds-ellipsis'):c.loader()),o.getCurrentStorage().loadAll((function(e){var t=n('#pages');t=t.length?t:n(c.render()),r.setContent(t);var o=t.find('#pages-container'),a=t.find('#templates-container');o.find(".".concat(i,"templates-card-2")).remove(),a.find(".".concat(i,"templates-card-2")).remove(),o.append(c.update(e.filter((function(e){return!e.template})))),a.append(c.update(e.filter((function(e){return e.template})),!1))}),(function(e){return console.log("Error",e)})),r.open(),r.getModel().once('change:open',(function(){u.classList.remove(a)}))}})};function A(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?A(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):A(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}t["default"]=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=_(_({},{dbName:'gjs',objectStoreName:'templates',loadFirst:!0,uuidInPath:!0,indexeddbVersion:4,onDelete:function(e){console.log('Deleted:',e)},onDeleteError:function(e){console.log(e)},onScreenshotError:function(e){console.log(e)},quality:.01,mdlTitle:'Template Manager',btnText:{new:'New Page',edit:'Edit Selected',create:'Create',createBlank:'Create Blank Template'},tabsText:{pages:'Pages',templates:'Templates'},nameLabel:'Name',help:'Select a template, enter page name, then click create. Use edit to modify the template.',nopages:'<div style="display:flex;align-items:center;padding:50px;margin:auto;">No Pages Yet</div>',apiKey:'',authDomain:'',projectId:'',enableOffline:!0,firebaseConfig:{},settings:{timestampsInSnapshots:!0}}),t);u(e,n),j(e,n),D(e,n),e.on('load',(function(){var t=e.Storage.getCurrentStorage();t.loadAll((function(r){var o=r[0];o&&n.loadFirst?(t.setId(o.id),t.setIdx(o.idx),t.setThumbnail(o.thumbnail),t.setIsTemplate(o.template),e.load()):t.setIdx(e.runCommand('get-uuidv4'))}))}))}}])}));
//# sourceMappingURL=grapesjs-template-manager.min.js.map